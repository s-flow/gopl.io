// 1.11 alexa.com에 있는 상위 100만 사이트와 같은 샘플을 이용해
// 더 긴 인자 목록으로 fetchall을 실행해보라.
// 웹사이트가 응답하지 않을 경우 프로그램이 어떻게 작동하는가?
// (8.9절에서 이러한 경우의 대처 방법을 설명한다)
// https://moz.com/top-500/download/?table=top500Domains

// fetchall
package main

import (
	"fmt"
	"io"
	"io/ioutil"
	"log"
	"net/http"
	_ "net/http/pprof" // pprof https://medium.com/@laeshiny/golang-package-pprof-in-net-http-9d34fcb6d675
	"time"
)

func main() {
	// pprof https://medium.com/@laeshiny/golang-package-pprof-in-net-http-9d34fcb6d675
	done := make(chan int)
	go func() {
		log.Println(http.ListenAndServe("localhost:6060", nil))
		done <- 1
	}()

	start := time.Now()
	ch := make(chan string)
	// for _, url := range os.Args[1:] {
	for _, url := range urls {
		go fetch(url, ch)
	}
	// for range os.Args[1:] {
	for range urls {
		fmt.Println(<-ch) // blocking
	}
	fmt.Printf("%.2fs elapsed\n", time.Since(start).Seconds())
	<-done
}

func fetch(url string, ch chan<- string) {
	start := time.Now()
	resp, err := http.Get(url)
	if err != nil {
		ch <- fmt.Sprint(err)
		return
	}

	nbytes, err := io.Copy(ioutil.Discard, resp.Body)
	resp.Body.Close()
	if err != nil {
		ch <- fmt.Sprintf("while reading %s: %v", url, err)
		return
	}
	secs := time.Since(start).Seconds()
	ch <- fmt.Sprintf("%.2fs %7d %s", secs, nbytes, url)
}

/*
go build -o ex1-11.exe
ex1-11.exe
동작이 버벅거린다. 리소스가 딸리는 느낌이다.
Goroutine 이 너무 많이 열렸나? 고루틴 자체는 마구 열 수 있지만
network 자원은 훨씬 유한한게 원인이 아닐까?

*/

var urls = []string{
	"http://apple.com",
	"http://www.google.com",
	"http://microsoft.com",
	"http://play.google.com",
	"http://youtube.com",
	"http://www.blogger.com",
	"http://docs.google.com",
	"http://support.google.com",
	"http://mozilla.org",
	"http://accounts.google.com",
	"http://sites.google.com",
	"http://wordpress.org",
	"http://en.wikipedia.org",
	"http://plus.google.com",
	"http://adobe.com",
	"http://googleusercontent.com",
	"http://github.com",
	"http://drive.google.com",
	"http://maps.google.com",
	"http://vimeo.com",
	"http://cloudflare.com",
	"http://youtu.be",
	"http://linkedin.com",
	"http://bp.blogspot.com",
	"http://europa.eu",
	"http://vk.com",
	"http://dailymotion.com",
	"http://bbc.co.uk",
	"http://medium.com",
	"http://line.me",
	"http://amazon.com",
	"http://live.com",
	"http://creativecommons.org",
	"http://istockphoto.com",
	"http://es.wikipedia.org",
	"http://washingtonpost.com",
	"http://paypal.com",
	"http://buydomains.com",
	"http://theguardian.com",
	"http://bbc.com",
	"http://t.me",
	"http://mediafire.com",
	"http://cnn.com",
	"http://google.es",
	"http://imdb.com",
	"http://wikimedia.org",
	"http://google.fr",
	"http://forbes.com",
	"http://developers.google.com",
	"http://mail.ru",
	"http://google.de",
	"http://slideshare.net",
	"http://gstatic.com",
	"http://google.co.uk",
	"http://photos.google.com",
	"http://facebook.com",
	"http://hugedomains.com",
	"http://msn.com",
	"http://nytimes.com",
	"http://news.google.com",
	"http://reuters.com",
	"http://google.co.jp",
	"http://myspace.com",
	"http://feedburner.com",
	"http://networkadvertising.org",
	"http://dropbox.com",
	"http://google.com.br",
	"http://mail.google.com",
	"http://policies.google.com",
	"http://www.yahoo.com",
	"http://w3.org",
	"http://uol.com.br",
	"http://fr.wikipedia.org",
	"http://nih.gov",
	"http://pt.wikipedia.org",
	"http://globo.com",
	"http://whatsapp.com",
	"http://goo.gl",
	"http://change.org",
	"http://steampowered.com",
	"http://wsj.com",
	"http://apache.org",
	"http://elpais.com",
	"http://youronlinechoices.com",
	"http://dailymail.co.uk",
	"http://wired.com",
	"http://huffingtonpost.com",
	"http://gnu.org",
	"http://www.wix.com",
	"http://terra.com.br",
	"http://ft.com",
	"http://rt.com",
	"http://bloomberg.com",
	"http://fb.com",
	"http://get.google.com",
	"http://ok.ru",
	"http://harvard.edu",
	"http://cpanel.net",
	"http://nypost.com",
	"http://opera.com",
	"http://aboutads.info",
	"http://groups.google.com",
	"http://marketingplatform.google.com",
	"http://independent.co.uk",
	"http://www.gov.uk",
	"http://amazon.de",
	"http://engadget.com",
	"http://de.wikipedia.org",
	"http://translate.google.com",
	"http://booking.com",
	"http://nasa.gov",
	"http://myaccount.google.com",
	"http://aliexpress.com",
	"http://thesun.co.uk",
	"http://archive.org",
	"http://tinyurl.com",
	"http://un.org",
	"http://ipv4.google.com",
	"http://bing.com",
	"http://code.google.com",
	"http://oracle.com",
	"http://google.ru",
	"http://foxnews.com",
	"http://aol.com",
	"http://amazon.co.uk",
	"http://soundcloud.com",
	"http://wikia.com",
	"http://android.com",
	"http://picasaweb.google.com",
	"http://twitter.com",
	"http://news.yahoo.com",
	"http://books.google.com",
	"http://hatena.ne.jp",
	"http://plesk.com",
	"http://abril.com.br",
	"http://ig.com.br",
	"http://telegraph.co.uk",
	"http://issuu.com",
	"http://pinterest.com",
	"http://telegram.me",
	"http://google.it",
	"http://lefigaro.fr",
	"http://usatoday.com",
	"http://scribd.com",
	"http://amazon.co.jp",
	"http://hp.com",
	"http://bit.ly",
	"http://files.wordpress.com",
	"http://techcrunch.com",
	"http://draft.blogger.com",
	"http://ted.com",
	"http://fandom.com",
	"http://samsung.com",
	"http://rakuten.co.jp",
	"http://tools.google.com",
	"http://ebay.com",
	"http://abcnews.go.com",
	"http://cnet.com",
	"http://google.com.tw",
	"http://secureserver.net",
	"http://list-manage.com",
	"http://nature.com",
	"http://so-net.ne.jp",
	"http://google.ca",
	"http://hm.com",
	"http://addthis.com",
	"http://time.com",
	"http://www.wikipedia.org",
	"http://google.nl",
	"http://it.wikipedia.org",
	"http://cnbc.com",
	"http://thestar.com",
	"http://gamespot.com",
	"http://photos1.blogger.com",
	"http://godaddy.com",
	"http://corriere.it",
	"http://columbia.edu",
	"http://m.wikipedia.org",
	"http://my.yahoo.com",
	"http://repubblica.it",
	"http://dan.com",
	"http://webmd.com",
	"http://channel4.com",
	"http://sciencedaily.com",
	"http://vice.com",
	"http://sapo.pt",
	"http://ovh.co.uk",
	"http://fastcompany.com",
	"http://instagram.com",
	"http://smh.com.au",
	"http://urbandictionary.com",
	"http://bp0.blogger.com",
	"http://intel.com",
	"http://news.com.au",
	"http://disqus.com",
	"http://rapidshare.com",
	"http://loc.gov",
	"http://soratemplates.com",
	"http://a8.net",
	"http://depositfiles.com",
	"http://sedo.com",
	"http://php.net",
	"http://lemonde.fr",
	"http://sendspace.com",
	"http://e-recht24.de",
	"http://yahoo.co.jp",
	"http://example.com",
	"http://bp3.blogger.com",
	"http://dell.com",
	"http://nginx.org",
	"http://berkeley.edu",
	"http://rtve.es",
	"http://imageshack.us",
	"http://britannica.com",
	"http://goo.ne.jp",
	"http://ietf.org",
	"http://marketwatch.com",
	"http://storage.googleapis.com",
	"http://netflix.com",
	"http://target.com",
	"http://xbox.com",
	"http://thetimes.co.uk",
	"http://playstation.com",
	"http://nba.com",
	"http://sciencedirect.com",
	"http://www.weebly.com",
	"http://ibm.com",
	"http://amazon.es",
	"http://gmail.com",
	"http://bp1.blogger.com",
	"http://bandcamp.com",
	"http://themeforest.net",
	"http://picasa.google.com",
	"http://adssettings.google.com",
	"http://huffpost.com",
	"http://theatlantic.com",
	"http://ox.ac.uk",
	"http://foursquare.com",
	"http://t.co",
	"http://umich.edu",
	"http://usnews.com",
	"http://mega.nz",
	"http://mit.edu",
	"http://vox.com",
	"http://namecheap.com",
	"http://fb.me",
	"http://alibaba.com",
	"http://finance.yahoo.com",
	"http://spotify.com",
	"http://cbc.ca",
	"http://worldbank.org",
	"http://windowsphone.com",
	"http://bund.de",
	"http://google.co.in",
	"http://ndtv.com",
	"http://goodreads.com",
	"http://chicagotribune.com",
	"http://bp2.blogger.com",
	"http://guardian.co.uk",
	"http://nginx.com",
	"http://000webhost.com",
	"http://ria.ru",
	"http://iubenda.com",
	"http://shutterstock.com",
	"http://indiatimes.com",
	"http://mashable.com",
	"http://xinhuanet.com",
	"http://kickstarter.com",
	"http://gooyaabitemplates.com",
	"http://theverge.com",
	"http://yadi.sk",
	"http://nationalgeographic.com",
	"http://about.com",
	"http://wa.me",
	"http://businessinsider.com",
	"http://biglobe.ne.jp",
	"http://psychologytoday.com",
	"http://abc.es",
	"http://pl.wikipedia.org",
	"http://cbsnews.com",
	"http://sky.com",
	"http://buzzfeed.com",
	"http://ovh.com",
	"http://ytimg.com",
	"http://wp.com",
	"http://privacyshield.gov",
	"http://asus.com",
	"http://blackberry.com",
	"http://elmundo.es",
	"http://www.over-blog.com",
	"http://interia.pl",
	"http://ggpht.com",
	"http://google.pl",
	"http://4shared.com",
	"http://noaa.gov",
	"http://npr.org",
	"http://id.wikipedia.org",
	"http://sciencemag.org",
	"http://stackoverflow.com",
	"http://pbs.org",
	"http://welt.de",
	"http://bitly.com",
	"http://nokia.com",
	"http://cpanel.com",
	"http://gofundme.com",
	"http://variety.com",
	"http://pixabay.com",
	"http://netsons.com",
	"http://disney.com",
	"http://eventbrite.com",
	"http://www.skyrock.com",
	"http://gravatar.com",
	"http://ru.wikipedia.org",
	"http://nydailynews.com",
	"http://wikihow.com",
	"http://stanford.edu",
	"http://cornell.edu",
	"http://newsweek.com",
	"http://oup.com",
	"http://mozilla.com",
	"http://mysql.com",
	"http://rambler.ru",
	"http://walmart.com",
	"http://yandex.ru",
	"http://ovh.net",
	"http://hollywoodreporter.com",
	"http://princeton.edu",
	"http://shopify.com",
	"http://parallels.com",
	"http://twitch.tv",
	"http://theglobeandmail.com",
	"http://nvidia.com",
	"http://rottentomatoes.com",
	"http://digg.com",
	"http://office.com",
	"http://dw.com",
	"http://akamaihd.net",
	"http://googleblog.com",
	"http://yelp.com",
	"http://amazon.fr",
	"http://bt.com",
	"http://economist.com",
	"http://metro.co.uk",
	"http://viglink.com",
	"http://search.yahoo.com",
	"http://tripadvisor.com",
	"http://addtoany.com",
	"http://nhk.or.jp",
	"http://ign.com",
	"http://google.co.id",
	"http://abc.net.au",
	"http://photobucket.com",
	"http://unesco.org",
	"http://naver.com",
	"http://instructables.com",
	"http://spiegel.de",
	"http://venturebeat.com",
	"http://who.int",
	"http://marriott.com",
	"http://naver.jp",
	"http://orange.fr",
	"http://express.co.uk",
	"http://ja.wikipedia.org",
	"http://zdnet.com",
	"http://lycos.com",
	"http://whitehouse.gov",
	"http://weibo.com",
	"http://espn.com",
	"http://latimes.com",
	"http://allaboutcookies.org",
	"http://yale.edu",
	"http://cdc.gov",
	"http://gizmodo.com",
	"http://cambridge.org",
	"http://box.com",
	"http://ea.com",
	"http://utexas.edu",
	"http://academia.edu",
	"http://netvibes.com",
	"http://search.google.com",
	"http://ikea.com",
	"http://doubleclick.net",
	"http://ask.fm",
	"http://zendesk.com",
	"http://qq.com",
	"http://cisco.com",
	"http://surveymonkey.com",
	"http://mirror.co.uk",
	"http://quora.com",
	"http://nifty.com",
	"http://epa.gov",
	"http://sports.yahoo.com",
	"http://answers.yahoo.com",
	"http://xfinity.com",
	"http://one.com",
	"http://storify.com",
	"http://ieee.org",
	"http://answers.com",
	"http://tabelog.com",
	"http://narod.ru",
	"http://tmz.com",
	"http://daum.net",
	"http://stores.jp",
	"http://geocities.jp",
	"http://sina.com.cn",
	"http://springer.com",
	"http://newscientist.com",
	"http://flickr.com",
	"http://nikkei.com",
	"http://www.canalblog.com",
	"http://standard.co.uk",
	"http://siemens.com",
	"http://prezi.com",
	"http://prnewswire.com",
	"http://web.fc2.com",
	"http://clickbank.net",
	"http://apachefriends.org",
	"http://feedproxy.google.com",
	"http://espn.go.com",
	"http://politico.com",
	"http://storage.canalblog.com",
	"http://eff.org",
	"http://home.neustar",
	"http://uspto.gov",
	"http://xing.com",
	"http://indiegogo.com",
	"http://ameblo.jp",
	"http://imgur.com",
	"http://histats.com",
	"http://thedailybeast.com",
	"http://jquery.com",
	"http://thenextweb.com",
	"http://scientificamerican.com",
	"http://ustream.tv",
	"http://ibtimes.com",
	"http://groups.yahoo.com",
	"http://newyorker.com",
	"http://vkontakte.ru",
	"http://people.com",
	"http://wiktionary.org",
	"http://skype.com",
	"http://quantcast.com",
	"http://megaupload.com",
	"http://nyu.edu",
	"http://alexa.com",
	"http://boston.com",
	"http://livescience.com",
	"http://wattpad.com",
	"http://wiley.com",
	"http://dictionary.com",
	"http://detik.com",
	"http://sakura.ne.jp",
	"http://redhat.com",
	"http://allrecipes.com",
	"http://wisc.edu",
	"http://seattletimes.com",
	"http://kinja.com",
	"http://jstor.org",
	"http://dribbble.com",
	"http://eonline.com",
	"http://nbcnews.com",
	"http://mixcloud.com",
	"http://trustpilot.com",
	"http://stuff.co.nz",
	"http://etsy.com",
	"http://gesetze-im-internet.de",
	"http://businesswire.com",
	"http://csmonitor.com",
	"http://aljazeera.com",
	"http://www.nhs.uk",
	"http://excite.co.jp",
	"http://merriam-webster.com",
	"http://asahi.com",
	"http://ssl-images-amazon.com",
	"http://usgs.gov",
	"http://uiuc.edu",
	"http://greenpeace.org",
	"http://howstuffworks.com",
	"http://gen.xyz",
	"http://fool.com",
	"http://amazon.ca",
	"http://washington.edu",
	"http://ftc.gov",
	"http://ucoz.ru",
	"http://bluehost.com",
	"http://thefreedictionary.com",
	"http://billboard.com",
	"http://t-online.de",
	"http://usa.gov",
	"http://calameo.com",
	"http://fifa.com",
	"http://symantec.com",
	"http://behance.net",
	"http://go.co",
	"http://odnoklassniki.ru",
	"http://lifehacker.com",
	"http://arxiv.org",
	"http://youku.com",
	"http://scoop.it",
	"http://ebay.co.uk",
}
